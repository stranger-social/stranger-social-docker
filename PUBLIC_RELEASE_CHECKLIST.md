# Public Release Checklist

This document verifies that the repository is ready to be published as a public, provider-agnostic Mastodon Docker setup.

## Security ✓

- [x] No `.env` files with secrets committed (protected by `.gitignore`)
- [x] No hardcoded credentials in code
- [x] `.env.example` provided with placeholders
- [x] CI workflow (`secret-scan.yml`) prevents accidental secret commits
- [x] Gitleaks integration scans full git history
- [x] Certbot-generated files not committed (`.gitkeep` placeholders only)

## Instance-Specific References Removed ✓

- [x] All "stranger.social" domain references replaced with "example.com" or parameterized
- [x] All hardcoded Linode volume paths replaced with parameterized `DB_DATA_DIR`
- [x] All instance IDs and identifiers removed from documentation
- [x] Linode-specific references replaced with generic provider examples

## Kubernetes Migration References Removed ✓

- [x] `MIGRATION_GUIDE.md` removed
- [x] `PRE_MIGRATION_CHECKLIST.md` sanitized
- [x] `COMPLETE_GUIDE.md` converted to deprecation notice pointing to `docs/`
- [x] `extract-k8s-secrets.sh` references removed from scripts
- [x] Kubernetes setup instructions moved to `docs/Home.md` (marked as optional)

## Documentation Consolidated ✓

- [x] All user-facing docs live in `docs/` folder
- [x] `docs/Home.md` contains setup, configuration, troubleshooting
- [x] `docs/MCP.md` contains GitHub MCP usage guide
- [x] Wiki sync workflow (`.github/workflows/sync-wiki.yml`) auto-publishes docs
- [x] README.md is concise and points to docs/wiki

## Configuration Generalized ✓

- [x] `docker-compose.yml` uses `${LOCAL_DOMAIN}` in healthchecks instead of hardcoded domain
- [x] `docker-compose.yml` uses `${DB_DATA_DIR}` for database volume mounts
- [x] Removed references to `.env.production` (now uses `.env` only)
- [x] `nginx/conf.d/default.conf` uses "example.com" placeholder instead of "stranger.social"
- [x] Scripts (`validate.sh`, `setup.sh`, `maintenance.sh`) parameterized to work anywhere

## Certbot Handling ✓

- [x] `certbot/conf/.gitkeep` created to preserve directory structure
- [x] `certbot/conf/live/.gitkeep` created for certificate placeholders
- [x] `certbot/www/.gitkeep` created for ACME challenge directory
- [x] `.gitignore` ignores all generated certbot files (renewal, archive, accounts, keys, etc.)
- [x] CI check prevents accidental commit of certbot-generated files

## Files Ready for Public Release

### ✓ Safe to commit:
- `docker-compose.yml` — parameterized, provider-agnostic
- `.env.example` — placeholders only, no real values
- `.gitignore` — protects secrets and generated files
- `.github/workflows/*.yml` — security and wiki sync automation
- `nginx/` — generic vhost with placeholder domain
- `docs/` — comprehensive, provider-neutral documentation
- `README.md` — concise, points to wiki
- `mastodon.service` — generic systemd service
- `setup.sh`, `maintenance.sh`, `validate.sh` — parameterized scripts

### ✗ Do NOT commit:
- `.env` — local secrets only
- `certbot/conf/renewal/` — generated by certbot
- `certbot/conf/archive/` — generated by certbot
- `certbot/conf/accounts/` — generated by certbot
- `certbot/conf/keys/` — generated by certbot
- `certbot/conf/csr/` — generated by certbot

### ℹ️ Metadata (safe but not essential):
- `COMPLETE_GUIDE.md` — deprecation notice
- Other *.md files in root (optional, docs are in `docs/`)

## Before Publishing

1. **Initialize Git:**
   ```bash
   git init
   git add .
   git commit -m "Initial commit: Mastodon Docker Compose setup"
   ```

2. **Verify no secrets are tracked:**
   ```bash
   git ls-files | xargs grep -l "SECRET_KEY_BASE\|AWS_SECRET_ACCESS_KEY\|SMTP_PASSWORD" || echo "✓ No secrets in repo"
   ```

3. **Create GitHub repository:**
   - Navigate to https://github.com/stranger-social
   - Create new repo (e.g., `mastodon-docker`)
   - Choose **Public** (or Private if preferred)
   - Enable **Discussions** (optional)
   - Enable **Wiki** (required for wiki sync)

4. **Add remote and push:**
   ```bash
   git remote add origin https://github.com/stranger-social/mastodon-docker.git
   git branch -M main
   git push -u origin main
   ```

5. **Enable Wiki sync:**
   - Go to repo settings > Features > enable "Wikis"
   - The `.github/workflows/sync-wiki.yml` workflow will auto-sync on push

6. **Set up GitHub MCP (optional):**
   - Create a Personal Access Token with `repo`, `workflow`, `admin:org_hook` scopes
   - Use in your GitHub MCP client configuration

## GitHub Org Access (MCP)

To use GitHub MCP with the `stranger-social` org:

1. **Create a Fine-Grained Personal Access Token:**
   - User Settings > Developer Settings > Personal Access Tokens > Fine-grained tokens
   - Scopes: `repo`, `workflow`, `admin:org_hook`, `read:org`
   - Resource owner: stranger-social org
   - Repositories: All (or specific repos)

2. **If org has SAML SSO enabled:**
   - Authorize the PAT: Org Settings > SAML SSO > Authorize PAT

3. **Use in MCP client config:**
   ```json
   {
     "name": "github",
     "settings": {
       "token": "github_pat_xxxxx",
       "baseUrl": "https://api.github.com"
     }
   }
   ```

## Summary

✅ **This repository is ready for public release.**

- All secrets protected
- All provider-specific references removed
- All instance-specific configuration parameterized
- Documentation consolidated and automated
- CI/CD security checks in place
- GitHub MCP compatible

Next step: Push to https://github.com/stranger-social/mastodon-docker
